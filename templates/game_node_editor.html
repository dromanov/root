<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>{{ data.get("stage_name", "") }}</title>

    <meta name="description" content="Source code generated using layoutit.com">
    <meta name="author" content="LayoutIt!">

    <link href="{{ static_url("bootstrap-3.3.7/css/bootstrap.min.css") }}" rel="stylesheet">
       <link rel="stylesheet" href="{{ static_url("chat.css") }}" type="text/css">
  </head>

<body class="container-fluid">
  <div class="row">
    <div class="col-sm-10 col-sm-offset-1">
      <h1>Редактор уровней</h1>
    </div>
  </div>

  {# Функция для генерации иконки из набора бутстрапа.  #}
  {% set glyph = lambda name: '<span class="glyphicon glyphicon-%s" aria-hidden="true"></span>' % name %}

  <form method="POST" class="form-horizontal">
    <div class="form-group">
      <label for="id_nik" class="col-sm-2 control-label">Код уровня: </label>
      <div class="col-sm-10">
        <input type="text"
               name="nik"
               id="id_nik"
               class="form-control"
               value="{{ data["nik"] }}"
               disabled>
      </div>
    </div>

    <div class="form-group">
      <label for="id_title" class="col-sm-2 control-label">Заголовок: </label>
      <div class="col-sm-10">
        <input type="text"
               class="form-control"
               name="title"
               id="id_title"
               value="{{ data.get("title", "") }}"
               autocomplete="off"
               placeholder="Короткий заголовок элемента квеста">
      </div>
    </div>

    <div class="form-group">
      <label for="id_task" class="col-sm-2 control-label">Описание задания:</label>
      <div class="col-sm-10">
        <textarea name="task"
                  id="id_task"
                  class="form-control"
                  rows="5"
                  placeholder="Описание задания (html можно)">{{
          data.get("task", "")
          }}</textarea>
      </div>
    </div>

    {# Список существующих уровней (карта-шпаргалка). #}
    <div class="form-group">
      <label for="id_nodes" class="col-sm-2 control-label">Существующие уровни:</label>
      <div class="col-sm-5">
        {# Existing nodes as drop-down lists. #}
        <div class="input-group">
          <div class="input-group-addon">
            {% raw glyph('map-marker') %}
          </div>
          <select class="form-control"
                  name="nodes"
                  id="id_nodes">
          {% for num, node in enumerate(nodes.values()) %}
          {# TODO: rename `nik` to `node_id`. #}
            <option>[{{ node["nik"] }}] {{ node["title"] }}"</option>
          {% end %}
          </select>
        </div>
      </div>
    </div>


    {# New node creation. #}
    <div class="form-group">
      <label for="id_node_make_new" class="col-sm-2 control-label">Создать уровень:</label>
      <div class="col-sm-5">
        <div class="input-group">
          <input type="text"
                 class="form-control"
                 name="make_new_node"
                 id="id_node_make_new"
                 value=""
                 autocomplete="off"
                 placeholder="Введите метку новой ноды (in English, a variable name)">
          <span class="input-group-btn">
            <button class="btn btn-success" type="button">
              {% raw glyph('plus') %}
              &nbsp;
              Добавить
            </button>
          </span>
        </div>
      </div>
    </div>


    {# Редактирование действий (Action). #}
    <div class="form-group">
      <label for="id_buttons" class="col-sm-2 control-label">
        Варианты действий:
      </label>
      <div class="col-sm-10">
        {# Уже существующие действия. #}
        {% for action_id in data.get('actions', []) %}
        {% set _a = action_details[action_id] %}
          <div class="btn-group">
            <button type="button" class="btn btn-primary">
              {% raw glyph(_a['icon']) %}
              &nbsp;
              {{ _a.get('title', '') or "--- NOT SET ---" }}
            </button>
            <button type="button" class="btn btn-primary dropdown-toggle"
                    data-toggle="dropdown" aria-haspopup="true"
                    aria-expanded="false">
              <span class="caret"></span>
              <span class="sr-only">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
              <li><a href="#">{% raw glyph('pencil') %} &nbsp; Edit</a></li>
              <li><a href="#">{% raw glyph('arrow-left') %} &nbsp; Move up</a></li>
              <li><a href="#">{% raw glyph('arrow-right') %} &nbsp; Move down</a></li>
              <li role="separator" class="divider"></li>
              <li><a href="?do=delete&action_id={{ _a['id'] }}">{% raw glyph('trash') %} &nbsp; Delete</a></li>
            </ul>
          </div>


        {% end %}

        {# Меню для создания нового действия (Action). #}
        <div class="btn-group">
          <button type="button" class="btn btn-success dropdown-toggle"
                  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            {% raw glyph('plus') %}
            &nbsp;
            Новое действие <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
            {% for icon, link, label in action_menu %}
              {% if icon != "---" %}
                <li><a href="../action_new/{{ link }}/{{ data['nik'] }}">
                  {% raw glyph(icon) %} &nbsp; {{ label }}
                </a></li>
              {% else %}
                <li role="separator" class="divider"></li>
              {%  end %}
            {%  end %}
          </ul>
        </div>
      </div>
    </div>

    <hr />
    <div class="row">
      <div class="col-sm-offset-2 col-sm-4">
        <button type="submit" class="btn btn-success">Сохранить</button>
        <a href="../game_node/{{ data["nik"] }}">
          <button type="button" class="btn btn-link">Отмена</button>
        </a>
      </div>
    </div>

    {% module xsrf_form_html() %}
  </form>

  <script src="{{ static_url("jquery.min.js") }}"></script>
  <script src="{{ static_url("bootstrap-3.3.7/js/bootstrap.min.js") }}"></script>
</body>
</html>
